# Архитектурный аудит системы: [System Name]

[EN](system-audit.en.md) | **RU**

---

## Исполнительное резюме

| Область                 | Оценка | Статус                         |
|-------------------------|--------|--------------------------------|
| Структура системы       | [1-5]  | [OK/Требует внимания/Критично] |
| Взаимодействие сервисов | [1-5]  | [OK/Требует внимания/Критично] |
| Паттерны и практики     | [1-5]  | [OK/Требует внимания/Критично] |
| Тестовое покрытие       | [1-5]  | [OK/Требует внимания/Критично] |
| Observability           | [1-5]  | [OK/Требует внимания/Критично] |
| Устойчивость            | [1-5]  | [OK/Требует внимания/Критично] |

**Общая оценка:** [X]/5

**Критические проблемы:** [X]
**Рекомендации к улучшению:** [X]

---

## 1. Обзор системы

### 1.1 Назначение и границы

| Параметр            | Значение                              |
|---------------------|---------------------------------------|
| Бизнес-домен        | [Описание]                            |
| Назначение системы  | [Описание]                            |
| Количество сервисов | [X]                                   |
| Архитектурный стиль | [Микросервисы/Модульный монолит/etc.] |
| Возраст системы     | [X лет/месяцев]                       |

### 1.2 Контекстная диаграмма (C4 Level 1)

```
[Вставить диаграмму или описание]

Внешние системы:
- [System A] - [назначение, тип интеграции]
- [System B] - [назначение, тип интеграции]

Пользователи:
- [User type 1] - [количество, паттерн использования]
- [User type 2] - [количество, паттерн использования]
```

---

## 2. Структура системы

### 2.1 Каталог сервисов

| # | Сервис      | Назначение | Технологии       | Владелец  | Критичность              |
|---|-------------|------------|------------------|-----------|--------------------------|
| 1 | [service-1] | [Описание] | [Go, PostgreSQL] | [Команда] | [Высокая/Средняя/Низкая] |
| 2 | [service-2] | [Описание] | [Go, Kafka]      | [Команда] | [Высокая/Средняя/Низкая] |
| 3 | [service-3] | [Описание] | [Python, Redis]  | [Команда] | [Высокая/Средняя/Низкая] |

### 2.2 Диаграмма контейнеров (C4 Level 2)

```
[Вставить диаграмму или описание взаимосвязей сервисов]
```

### 2.3 Bounded Contexts (если DDD)

| Context     | Сервисы                | Core/Supporting/Generic |
|-------------|------------------------|-------------------------|
| [Context 1] | [service-1, service-2] | [Core Domain]           |
| [Context 2] | [service-3]            | [Supporting]            |
| [Context 3] | [service-4]            | [Generic]               |

### 2.4 Оценка структуры

- [ ] Сервисы имеют чёткие границы ответственности
- [ ] Нет дублирования функциональности между сервисами
- [ ] Размер сервисов адекватен (не слишком большие, не слишком мелкие)
- [ ] Есть чёткое разделение на слои (API Gateway, BFF, Backend, Data)

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 3. Взаимодействие сервисов

### 3.1 Синхронные взаимодействия

| Источник    | Получатель  | Протокол    | Назначение | SLA    |
|-------------|-------------|-------------|------------|--------|
| [service-1] | [service-2] | [REST/gRPC] | [Описание] | [X ms] |
| [service-2] | [service-3] | [REST/gRPC] | [Описание] | [X ms] |

**Оценка:**
- [ ] Timeout'ы настроены корректно
- [ ] Есть retry с exponential backoff
- [ ] Есть circuit breaker
- [ ] Нет синхронных цепочек > 3 сервисов

### 3.2 Асинхронные взаимодействия

| Publisher   | Topic/Queue | Consumer               | Broker  | Гарантия доставки |
|-------------|-------------|------------------------|---------|-------------------|
| [service-1] | [topic-1]   | [service-2]            | [Kafka] | [At-least-once]   |
| [service-2] | [topic-2]   | [service-3, service-4] | [Kafka] | [At-least-once]   |

**Оценка:**
- [ ] Consumer'ы идемпотентны
- [ ] Есть DLQ для failed messages
- [ ] Настроен мониторинг lag'а
- [ ] Есть стратегия обработки poison messages

### 3.3 Матрица зависимостей

|       | svc-1 | svc-2 | svc-3 | svc-4 | svc-5 |
|-------|-------|-------|-------|-------|-------|
| svc-1 | -     | S     | A     | -     | -     |
| svc-2 | -     | -     | S     | A     | -     |
| svc-3 | -     | -     | -     | -     | S     |
| svc-4 | -     | -     | -     | -     | A     |
| svc-5 | -     | -     | -     | -     | -     |

*S = Sync, A = Async*

### 3.4 Критические пути

| # | Путь                                      | Latency (p99) | Риск       |
|---|-------------------------------------------|---------------|------------|
| 1 | [User -> API GW -> svc-1 -> svc-2 -> DB]  | [X ms]        | [Описание] |
| 2 | [Event -> svc-3 -> svc-4 -> External API] | [X ms]        | [Описание] |

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 4. Паттерны и практики

### 4.1 Используемые паттерны

| Паттерн         | Где используется       | Реализация                   | Оценка            |
|-----------------|------------------------|------------------------------|-------------------|
| API Gateway     | [service-gateway]      | [Kong/Custom]                | [OK/Частично/Нет] |
| Circuit Breaker | [service-1, service-2] | [hystrix/resilience4j]       | [OK/Частично/Нет] |
| Saga            | [order-service]        | [Choreography/Orchestration] | [OK/Частично/Нет] |
| CQRS            | [reporting-service]    | [Описание]                   | [OK/Частично/Нет] |
| Event Sourcing  | [audit-service]        | [Описание]                   | [OK/Частично/Нет] |
| Outbox Pattern  | [service-1]            | [Debezium/Custom]            | [OK/Частично/Нет] |
| Sidecar         | [all services]         | [Envoy/Linkerd]              | [OK/Частично/Нет] |

### 4.2 Архитектурные решения (ADR)

| ADR     | Название                   | Статус     | Контекст |
|---------|----------------------------|------------|----------|
| ADR-001 | [Выбор message broker]     | [Accepted] | [Ссылка] |
| ADR-002 | [Стратегия аутентификации] | [Accepted] | [Ссылка] |
| ADR-003 | [Подход к кэшированию]     | [Accepted] | [Ссылка] |

**Оценка:**
- [ ] ADR документируются для значимых решений
- [ ] ADR содержат контекст, решение, последствия
- [ ] Deprecated ADR помечены и есть ссылки на замену

### 4.3 Антипаттерны

| # | Антипаттерн          | Где обнаружен                        | Влияние   | Рекомендация          |
|---|----------------------|--------------------------------------|-----------|-----------------------|
| 1 | Distributed Monolith | [service-1, service-2 тесно связаны] | [Высокое] | [Рефакторинг границ]  |
| 2 | Sync over Async      | [service-3 блокирующе ждёт Kafka]    | [Среднее] | [Переделать на async] |
| 3 | Shared Database      | [service-4, service-5 одна БД]       | [Высокое] | [Разделить БД]        |

---

## 5. Данные и хранилища

### 5.1 Базы данных

| Сервис      | БД           | Тип        | Размер | Резервирование   |
|-------------|--------------|------------|--------|------------------|
| [service-1] | [PostgreSQL] | [OLTP]     | [X GB] | [Master-Replica] |
| [service-2] | [MongoDB]    | [Document] | [X GB] | [ReplicaSet]     |
| [service-3] | [ClickHouse] | [OLAP]     | [X GB] | [Cluster]        |

### 5.2 Кэширование

| Сервис      | Кэш         | Стратегия       | TTL     | Hit Rate |
|-------------|-------------|-----------------|---------|----------|
| [service-1] | [Redis]     | [Cache-aside]   | [X min] | [X%]     |
| [service-2] | [Memcached] | [Write-through] | [X min] | [X%]     |

### 5.3 Консистентность данных

| Сценарий              | Уровень консистентности | Реализация   |
|-----------------------|-------------------------|--------------|
| [Создание заказа]     | [Strong]                | [2PC/Saga]   |
| [Обновление каталога] | [Eventual]              | [Events]     |
| [Аналитика]           | [Eventual]              | [CDC -> DWH] |

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 6. Тестовое покрытие

### 6.1 Покрытие по сервисам

| Сервис      | Unit | Integration | E2E  | Contract | Общее |
|-------------|------|-------------|------|----------|-------|
| [service-1] | [X%] | [X%]        | [X%] | [Да/Нет] | [X%]  |
| [service-2] | [X%] | [X%]        | [X%] | [Да/Нет] | [X%]  |
| [service-3] | [X%] | [X%]        | [X%] | [Да/Нет] | [X%]  |

**Норма:** Unit >= 70%, Integration >= 50%, E2E - критические пути

### 6.2 Contract Testing

- [ ] Используется contract testing (Pact, etc.)
- [ ] Consumer-driven contracts
- [ ] Контракты версионируются
- [ ] Есть CI проверка контрактов

### 6.3 Нагрузочное тестирование

| Сценарий      | Инструмент   | Последний запуск | Результат           |
|---------------|--------------|------------------|---------------------|
| [Peak load]   | [k6/Gatling] | [YYYY-MM-DD]     | [X RPS, Y ms p99]   |
| [Stress test] | [k6/Gatling] | [YYYY-MM-DD]     | [Лимит X RPS]       |
| [Soak test]   | [k6/Gatling] | [YYYY-MM-DD]     | [Стабильно X часов] |

### 6.4 Chaos Engineering

- [ ] Проводятся chaos эксперименты
- [ ] Есть gamedays
- [ ] Документированы известные точки отказа

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 7. Observability

### 7.1 Метрики

| Уровень        | Инструмент          | Покрытие | Retention |
|----------------|---------------------|----------|-----------|
| Infrastructure | [Prometheus]        | [X%]     | [X дней]  |
| Application    | [Prometheus]        | [X%]     | [X дней]  |
| Business       | [Custom/Prometheus] | [X%]     | [X дней]  |

**Ключевые метрики:**
- [ ] RED метрики (Rate, Errors, Duration) для всех сервисов
- [ ] USE метрики (Utilization, Saturation, Errors) для инфраструктуры
- [ ] Бизнес-метрики (конверсия, заказы, etc.)

### 7.2 Логирование

| Параметр                     | Значение          |
|------------------------------|-------------------|
| Централизованное логирование | [ELK/Loki/etc.]   |
| Формат логов                 | [JSON/Structured] |
| Correlation ID               | [Да/Нет]          |
| Retention                    | [X дней]          |

**Оценка:**
- [ ] Единый формат логов во всех сервисах
- [ ] Есть correlation/trace ID
- [ ] Логи не содержат sensitive данных
- [ ] Настроены уровни логирования

### 7.3 Трейсинг

| Параметр            | Значение              |
|---------------------|-----------------------|
| Distributed tracing | [Jaeger/Tempo/Zipkin] |
| Покрытие сервисов   | [X%]                  |
| Sampling rate       | [X%]                  |

**Оценка:**
- [ ] Трейсы связаны между сервисами
- [ ] Span'ы содержат полезную информацию
- [ ] Есть алерты на аномальные трейсы

### 7.4 Алертинг

| Категория            | Количество алертов | Покрытие   |
|----------------------|--------------------|------------|
| Critical (PagerDuty) | [X]                | [Описание] |
| Warning (Slack)      | [X]                | [Описание] |
| Info                 | [X]                | [Описание] |

**Оценка:**
- [ ] Алерты actionable (понятно что делать)
- [ ] Есть runbooks для critical алертов
- [ ] Нет alert fatigue (< 5 critical/день в норме)
- [ ] Настроены escalation policies

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 8. Устойчивость и отказоустойчивость

### 8.1 Single Points of Failure

| # | Компонент  | Риск                          | Митигация             |
|---|------------|-------------------------------|-----------------------|
| 1 | [Описание] | [Критический/Высокий/Средний] | [Текущая/Планируемая] |
| 2 | [Описание] | [Критический/Высокий/Средний] | [Текущая/Планируемая] |

### 8.2 Graceful Degradation

| Сценарий отказа     | Поведение системы            | Оценка   |
|---------------------|------------------------------|----------|
| [БД недоступна]     | [Fallback на кэш / Ошибка]   | [OK/Нет] |
| [External API down] | [Circuit breaker / Retry]    | [OK/Нет] |
| [Kafka недоступна]  | [Локальная очередь / Ошибка] | [OK/Нет] |

### 8.3 Масштабируемость

| Сервис      | Текущая нагрузка | Лимит   | Bottleneck       |
|-------------|------------------|---------|------------------|
| [service-1] | [X RPS]          | [Y RPS] | [DB connections] |
| [service-2] | [X RPS]          | [Y RPS] | [CPU]            |

### 8.4 Disaster Recovery

| Параметр          | Требование | Текущее      | Статус   |
|-------------------|------------|--------------|----------|
| RTO               | [X часов]  | [Y часов]    | [OK/NOK] |
| RPO               | [X часов]  | [Y часов]    | [OK/NOK] |
| Последний DR тест | -          | [YYYY-MM-DD] | [OK/NOK] |

**Проблемы:**
| # | Проблема   | Влияние                  | Рекомендация |
|---|------------|--------------------------|--------------|
| 1 | [Описание] | [Высокое/Среднее/Низкое] | [Что делать] |

---

## 9. Безопасность

### 9.1 Аутентификация и авторизация

| Аспект                  | Реализация           | Оценка            |
|-------------------------|----------------------|-------------------|
| Service-to-service auth | [mTLS/JWT/API Keys]  | [OK/Частично/Нет] |
| User authentication     | [OAuth2/OIDC/Custom] | [OK/Частично/Нет] |
| Authorization           | [RBAC/ABAC/Custom]   | [OK/Частично/Нет] |

### 9.2 Защита данных

- [ ] Шифрование at rest
- [ ] Шифрование in transit (TLS везде)
- [ ] Маскирование PII в логах
- [ ] Secrets в Vault/k8s secrets (не в коде)

### 9.3 Известные уязвимости

| # | Уязвимость | Сервис      | Severity               | Статус       |
|---|------------|-------------|------------------------|--------------|
| 1 | [Описание] | [service-1] | [Critical/High/Medium] | [Open/Fixed] |

---

## 10. Сводка проблем и рекомендаций

### 10.1 Критические проблемы

| # | Проблема   | Область                         | Рекомендация | Приоритет |
|---|------------|---------------------------------|--------------|-----------|
| 1 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P0        |
| 2 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P0        |

### 10.2 Важные улучшения

| # | Проблема   | Область                         | Рекомендация | Приоритет |
|---|------------|---------------------------------|--------------|-----------|
| 1 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P1        |
| 2 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P1        |

### 10.3 Желательные улучшения

| # | Проблема   | Область                         | Рекомендация | Приоритет |
|---|------------|---------------------------------|--------------|-----------|
| 1 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P2        |
| 2 | [Описание] | [Структура/Взаимодействие/etc.] | [Что делать] | P2        |

---

## 11. План улучшений

### Ближайшие действия (1-2 недели)

- [ ] [Действие 1] - владелец: [ФИО]
- [ ] [Действие 2] - владелец: [ФИО]

### Среднесрочные (1-3 месяца)

- [ ] [Действие 1] - владелец: [ФИО]
- [ ] [Действие 2] - владелец: [ФИО]

### Долгосрочные (3+ месяца)

- [ ] [Действие 1] - владелец: [ФИО]
- [ ] [Действие 2] - владелец: [ФИО]

---

## 12. Заключение

**Общая оценка системы:** [X]/5

| Критерий                | Оценка | Комментарий   |
|-------------------------|--------|---------------|
| Архитектурная зрелость  | [1-5]  | [Комментарий] |
| Операционная готовность | [1-5]  | [Комментарий] |
| Устойчивость к отказам  | [1-5]  | [Комментарий] |
| Масштабируемость        | [1-5]  | [Комментарий] |
| Безопасность            | [1-5]  | [Комментарий] |

**Ключевые выводы:**
1. [Вывод 1]
2. [Вывод 2]
3. [Вывод 3]

**Следующий аудит рекомендуется:** [через X месяцев]

---

*Аудит проведён: [YYYY-MM-DD]*
